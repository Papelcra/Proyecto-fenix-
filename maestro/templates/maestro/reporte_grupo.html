{% extends 'base.html' %}
{% load dict_extras %}
{% block title %}Reporte de Asistencias | Club F√©nix{% endblock %}
{% block content %}
<style>
  body {
    background: linear-gradient(to right, #0a0a0a, #002b5b);
    color: white;
  }
  .bloque-nav {
    margin-bottom: 16px;
  }
  .bloque-nav a {
    background: #001a33;
    color: #00bfff;
    border-radius: 5px;
    font-weight: 600;
    padding: 7px 20px;
    border: 1px solid #00bfff44;
    margin-right: 8px;
    text-decoration: none;
    transition: background 0.2s,color 0.2s;
  }
  .bloque-nav a:hover {
    background: #00bfff;
    color: #fff;
  }
  .tabla-oscura {
    width: 100%;
    border-collapse: collapse;
    background: rgba(255,255,255,0.08);
    border-radius: 10px;
    margin-bottom: 1.6rem;
    overflow: hidden;
  }
  .tabla-oscura thead {
    background: rgba(0, 191, 255, 0.15);
  }
  .tabla-oscura th, .tabla-oscura td {
    padding: 1rem;
    text-align: center;
    border-bottom: 1px solid rgba(255,255,255,0.08);
  }
  .tabla-oscura th {
    color: #00bfff;
    font-weight: bold;
    border-top: 2px solid #00bfff44;
    font-size: 1.06rem;
  }
  .tabla-oscura tr:hover {
    background: rgba(0,191,255,0.08);
  }
  .resumen-grupo {
    margin:20px 0 0 0;
    padding:18px;
    background:rgba(255,255,255,0.09);
    border:1.5px solid #00bfff33;
    max-width:420px;
    font-size:1.14em;
    border-radius: 12px;
    color:white;
  }
  .alert-fenix { max-width: 540px; margin: 18px auto 22px auto; background: linear-gradient(90deg, #004aad 70%, #00bfff 100%); color: #fff; border-radius: 10px; padding: 1.2em 2em; box-shadow: 0 4px 20px #00bfff44; font-size: 1.18em; border-left: 7px solid #00ffea; font-weight: bold; letter-spacing: .8px; display: flex; align-items: center; gap: 12px; animation: aparecerAlertFenix 1s cubic-bezier(.16,1,.29,.99);}
  @keyframes aparecerAlertFenix {0% {transform: translateY(-25px); opacity:0;} 100% {transform: translateY(0); opacity:1;}}
  .alert-fenix.success { background: linear-gradient(90deg, #00938f 65%, #25caa5 100%);}
  .alert-fenix.info { background: linear-gradient(90deg, #004aad 70%, #00bfff 100%);}
  .alert-fenix.warning { background: linear-gradient(80deg, #eabb19 60%, #ff9f0f 100%);}
  .alert-fenix.error { background: linear-gradient(80deg, #c62222 65%, #ff2b36 100%);}
  .alert-fenix .icon {font-size:1.4em;margin-right:7px;}
</style>

<h1 style="text-align:center;">Reporte de asistencias<br><span style="color:#00bfff;font-size:1.2em;">Grupo {{ grupo.nombre }}</span></h1>
<div class="bloque-nav">
  <a href="{% url 'maestro:dashboard' %}">üè† Dashboard</a>
  <a href="{% url 'maestro:alumnos_por_grupo' grupo.id %}">üë• Ver alumnos</a>
  <a href="{% url 'maestro:registrar_asistencia_grupo' grupo.id %}">‚úÖ Registrar asistencia</a>
</div>

{% if messages %}
  {% for message in messages %}
    <div class="alert-fenix {{ message.tags }}">
      <span class="icon">
        {% if "success" in message.tags %}‚úîÔ∏è{% endif %}
        {% if "error" in message.tags %}‚ùå{% endif %}
        {% if "warning" in message.tags %}‚ö†Ô∏è{% endif %}
        {% if "info" in message.tags %}‚ÑπÔ∏è{% endif %}
      </span>
      {{ message }}
    </div>
  {% endfor %}
{% endif %}

<div style="display: flex; flex-wrap: wrap; gap: 24px;">
  <div style="flex: 1 1 440px; min-width: 380px;">
    <table class="tabla-oscura">
      <thead>
        <tr>
          <th>Alumno</th>
          <th>Asistencias</th>
          <th>Faltas</th>
          <th>√öltima observaci√≥n</th>
        </tr>
      </thead>
      <tbody>
        {% for alumno, stats in reporte.items %}
        <tr>
          <td>{{ alumno.user.get_full_name|default:alumno.user.username }}</td>
          <td>{{ stats.asistencias }}</td>
          <td>{{ stats.faltas }}</td>
          <td>{{ ultimas_obs|dict_get:alumno.id }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <div class="resumen-grupo">
      <strong>Resumen del grupo:</strong><br>
      Total de registros: <span style="font-weight:bold;">{{ total_registros }}</span><br>
      Asistencias: <span style="color:#22a; font-size:2.1em; font-weight:bold;">{{ porcentaje_asistencias|floatformat:2 }}%</span><br>
      Faltas: <span style="color:#c22; font-size:2.1em; font-weight:bold;">{{ porcentaje_faltas|floatformat:2 }}%</span>
    </div>
  </div>
</div>
{% endblock %}
